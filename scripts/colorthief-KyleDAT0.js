if(!M)var M={map:function(s,c){var b={};return c?s.map(function(v,p){return b.index=p,c.call(b,v)}):s.slice()},naturalOrder:function(s,c){return s<c?-1:s>c?1:0},sum:function(s,c){var b={};return s.reduce(c?function(v,p,m){return b.index=m,v+c.call(b,p)}:function(v,p){return v+p},0)},max:function(s,c){return Math.max.apply(null,c?M.map(s,c):s)}};var A=function(){var s=5,c=8-s,b=1e3;function v(r,t,n){return(r<<2*s)+(t<<s)+n}function p(r){var t=[],n=!1;function f(){t.sort(r),n=!0}return{push:function(e){t.push(e),n=!1},peek:function(e){return n||f(),e===void 0&&(e=t.length-1),t[e]},pop:function(){return n||f(),t.pop()},size:function(){return t.length},map:function(e){return t.map(e)},debug:function(){return n||f(),t}}}function m(r,t,n,f,e,o,h){var u=this;u.r1=r,u.r2=t,u.g1=n,u.g2=f,u.b1=e,u.b2=o,u.histo=h}function _(){this.vboxes=new p(function(r,t){return M.naturalOrder(r.vbox.count()*r.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function q(r,t){if(t.count()){var n=t.r2-t.r1+1,f=t.g2-t.g1+1,e=M.max([n,f,t.b2-t.b1+1]);if(t.count()==1)return[t.copy()];var o,h,u,a,l=0,g=[],d=[];if(e==n)for(o=t.r1;o<=t.r2;o++){for(a=0,h=t.g1;h<=t.g2;h++)for(u=t.b1;u<=t.b2;u++)a+=r[v(o,h,u)]||0;g[o]=l+=a}else if(e==f)for(o=t.g1;o<=t.g2;o++){for(a=0,h=t.r1;h<=t.r2;h++)for(u=t.b1;u<=t.b2;u++)a+=r[v(h,o,u)]||0;g[o]=l+=a}else for(o=t.b1;o<=t.b2;o++){for(a=0,h=t.r1;h<=t.r2;h++)for(u=t.g1;u<=t.g2;u++)a+=r[v(h,u,o)]||0;g[o]=l+=a}return g.forEach(function(w,x){d[x]=l-w}),function(w){var x,E,y,k,C,I=w+"1",z=w+"2",O=0;for(o=t[I];o<=t[z];o++)if(g[o]>l/2){for(y=t.copy(),k=t.copy(),C=(x=o-t[I])<=(E=t[z]-o)?Math.min(t[z]-1,~~(o+E/2)):Math.max(t[I],~~(o-1-x/2));!g[C];)C++;for(O=d[C];!O&&g[C-1];)O=d[--C];return y[z]=C,k[I]=y[z]+1,[y,k]}}(e==n?"r":e==f?"g":"b")}}return m.prototype={volume:function(r){var t=this;return t._volume&&!r||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(r){var t=this,n=t.histo;if(!t._count_set||r){var f,e,o,h=0;for(f=t.r1;f<=t.r2;f++)for(e=t.g1;e<=t.g2;e++)for(o=t.b1;o<=t.b2;o++)h+=n[v(f,e,o)]||0;t._count=h,t._count_set=!0}return t._count},copy:function(){var r=this;return new m(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(r){var t=this,n=t.histo;if(!t._avg||r){var f,e,o,h,u=0,a=1<<8-s,l=0,g=0,d=0;for(e=t.r1;e<=t.r2;e++)for(o=t.g1;o<=t.g2;o++)for(h=t.b1;h<=t.b2;h++)u+=f=n[v(e,o,h)]||0,l+=f*(e+.5)*a,g+=f*(o+.5)*a,d+=f*(h+.5)*a;t._avg=u?[~~(l/u),~~(g/u),~~(d/u)]:[~~(a*(t.r1+t.r2+1)/2),~~(a*(t.g1+t.g2+1)/2),~~(a*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(r){var t=this,n=r[0]>>c;return gval=r[1]>>c,bval=r[2]>>c,n>=t.r1&&n<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},_.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var t=this.vboxes,n=0;n<t.size();n++)if(t.peek(n).vbox.contains(r))return t.peek(n).color;return this.nearest(r)},nearest:function(r){for(var t,n,f,e=this.vboxes,o=0;o<e.size();o++)((n=Math.sqrt(Math.pow(r[0]-e.peek(o).color[0],2)+Math.pow(r[1]-e.peek(o).color[1],2)+Math.pow(r[2]-e.peek(o).color[2],2)))<t||t===void 0)&&(t=n,f=e.peek(o).color);return f},forcebw:function(){var r=this.vboxes;r.sort(function(e,o){return M.naturalOrder(M.sum(e.color),M.sum(o.color))});var t=r[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(r[0].color=[0,0,0]);var n=r.length-1,f=r[n].color;f[0]>251&&f[1]>251&&f[2]>251&&(r[n].color=[255,255,255])}},{quantize:function(r,t){if(!r.length||t<2||t>256)return!1;var n=function(a){var l,g=new Array(1<<3*s);return a.forEach(function(d){l=v(d[0]>>c,d[1]>>c,d[2]>>c),g[l]=(g[l]||0)+1}),g}(r);n.forEach(function(){});var f=function(a,l){var g,d,w,x=1e6,E=0,y=1e6,k=0,C=1e6,I=0;return a.forEach(function(z){(g=z[0]>>c)<x?x=g:g>E&&(E=g),(d=z[1]>>c)<y?y=d:d>k&&(k=d),(w=z[2]>>c)<C?C=w:w>I&&(I=w)}),new m(x,E,y,k,C,I,l)}(r,n),e=new p(function(a,l){return M.naturalOrder(a.count(),l.count())});function o(a,l){for(var g,d=a.size(),w=0;w<b;){if(d>=l||w++>b)return;if((g=a.pop()).count()){var x=q(n,g),E=x[0],y=x[1];if(!E)return;a.push(E),y&&(a.push(y),d++)}else a.push(g),w++}}e.push(f),o(e,.75*t);for(var h=new p(function(a,l){return M.naturalOrder(a.count()*a.volume(),l.count()*l.volume())});e.size();)h.push(e.pop());o(h,t);for(var u=new _;h.size();)u.push(h.pop());return u}}}().quantize,P=function(s){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=s.naturalWidth,this.height=this.canvas.height=s.naturalHeight,this.context.drawImage(s,0,0,this.width,this.height)};P.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var D=function(){};D.prototype.getColor=function(s,c){return c===void 0&&(c=10),this.getPalette(s,5,c)[0]},D.prototype.getPalette=function(s,c,b){var v=function(q){var r=q.colorCount,t=q.quality;if(r!==void 0&&Number.isInteger(r)){if(r===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;return(t===void 0||!Number.isInteger(t)||t<1)&&(t=10),{colorCount:r,quality:t}}({colorCount:c,quality:b}),p=new P(s),m=function(q,r,t){for(var n,f,e,o,h,u=q,a=[],l=0;l<r;l+=t)f=u[0+(n=4*l)],e=u[n+1],o=u[n+2],((h=u[n+3])===void 0||h>=125)&&(f>250&&e>250&&o>250||a.push([f,e,o]));return a}(p.getImageData().data,p.width*p.height,v.quality),_=A(m,v.colorCount);return _?_.palette():null},D.prototype.getColorFromUrl=function(s,c,b){var v=this,p=document.createElement("img");p.addEventListener("load",function(){var m=v.getPalette(p,5,b);c(m[0],s)}),p.src=s},D.prototype.getImageData=function(s,c){var b=new XMLHttpRequest;b.open("GET",s,!0),b.responseType="arraybuffer",b.onload=function(){if(this.status==200){var v=new Uint8Array(this.response);i=v.length;for(var p=new Array(i),m=0;m<v.length;m++)p[m]=String.fromCharCode(v[m]);var _=p.join(""),q=window.btoa(_);c("data:image/png;base64,"+q)}},b.send()},D.prototype.getColorAsync=function(s,c,b){var v=this;this.getImageData(s,function(p){var m=document.createElement("img");m.addEventListener("load",function(){var _=v.getPalette(m,5,b);c(_[0],this)}),m.src=p})};export{D as o};
