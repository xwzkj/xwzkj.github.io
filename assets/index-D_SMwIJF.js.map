{"version":3,"file":"index-D_SMwIJF.js","sources":["../../node_modules/vueuc/es/shared/resolve-to.js","../../node_modules/vueuc/es/focus-trap/src/utils.js","../../node_modules/vueuc/es/focus-trap/src/index.js"],"sourcesContent":["export function resolveTo(selector) {\n    if (typeof selector === 'string') {\n        return document.querySelector(selector);\n    }\n    return selector();\n}\n","/* eslint-disable @typescript-eslint/strict-boolean-expressions */\n// ref https://www.w3.org/TR/wai-aria-practices-1.1/examples/dialog-modal/js/dialog.js\nfunction isHTMLElement(node) {\n    return node instanceof HTMLElement;\n}\nexport function focusFirstDescendant(node) {\n    for (let i = 0; i < node.childNodes.length; i++) {\n        const child = node.childNodes[i];\n        if (isHTMLElement(child)) {\n            if (attemptFocus(child) || focusFirstDescendant(child)) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nexport function focusLastDescendant(element) {\n    for (let i = element.childNodes.length - 1; i >= 0; i--) {\n        const child = element.childNodes[i];\n        if (isHTMLElement(child)) {\n            if (attemptFocus(child) || focusLastDescendant(child)) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\nfunction attemptFocus(element) {\n    if (!isFocusable(element)) {\n        return false;\n    }\n    try {\n        element.focus({ preventScroll: true });\n    }\n    catch (e) { }\n    return document.activeElement === element;\n}\nfunction isFocusable(element) {\n    if (element.tabIndex > 0 ||\n        (element.tabIndex === 0 && element.getAttribute('tabIndex') !== null)) {\n        return true;\n    }\n    if (element.getAttribute('disabled')) {\n        return false;\n    }\n    switch (element.nodeName) {\n        case 'A':\n            return (!!element.href &&\n                element.rel !== 'ignore');\n        case 'INPUT':\n            return (element.type !== 'hidden' &&\n                element.type !== 'file');\n        case 'BUTTON':\n        case 'SELECT':\n        case 'TEXTAREA':\n            return true;\n        default:\n            return false;\n    }\n}\n","import { h, defineComponent, ref, Fragment, onMounted, onBeforeUnmount, watch } from 'vue';\nimport { createId, getPreciseEventTarget } from 'seemly';\nimport { on, off } from 'evtd';\nimport { focusFirstDescendant, focusLastDescendant } from './utils';\nimport { resolveTo } from '../../shared';\nlet stack = [];\nexport const FocusTrap = defineComponent({\n    name: 'FocusTrap',\n    props: {\n        disabled: Boolean,\n        active: Boolean,\n        autoFocus: {\n            type: Boolean,\n            default: true\n        },\n        onEsc: Function,\n        initialFocusTo: String,\n        finalFocusTo: String,\n        returnFocusOnDeactivated: {\n            type: Boolean,\n            default: true\n        }\n    },\n    setup(props) {\n        const id = createId();\n        const focusableStartRef = ref(null);\n        const focusableEndRef = ref(null);\n        let activated = false;\n        let ignoreInternalFocusChange = false;\n        const lastFocusedElement = typeof document === 'undefined' ? null : document.activeElement;\n        function isCurrentActive() {\n            const currentActiveId = stack[stack.length - 1];\n            return currentActiveId === id;\n        }\n        function handleDocumentKeydown(e) {\n            var _a;\n            if (e.code === 'Escape') {\n                if (isCurrentActive()) {\n                    (_a = props.onEsc) === null || _a === void 0 ? void 0 : _a.call(props, e);\n                }\n            }\n        }\n        onMounted(() => {\n            watch(() => props.active, (value) => {\n                if (value) {\n                    activate();\n                    on('keydown', document, handleDocumentKeydown);\n                }\n                else {\n                    off('keydown', document, handleDocumentKeydown);\n                    if (activated) {\n                        deactivate();\n                    }\n                }\n            }, {\n                immediate: true\n            });\n        });\n        onBeforeUnmount(() => {\n            off('keydown', document, handleDocumentKeydown);\n            if (activated)\n                deactivate();\n        });\n        function handleDocumentFocus(e) {\n            if (ignoreInternalFocusChange)\n                return;\n            if (isCurrentActive()) {\n                const mainEl = getMainEl();\n                if (mainEl === null)\n                    return;\n                if (mainEl.contains(getPreciseEventTarget(e)))\n                    return;\n                // I don't handle shift + tab status since it's too tricky to handle\n                // Not impossible but I need to sleep\n                resetFocusTo('first');\n            }\n        }\n        function getMainEl() {\n            const focusableStartEl = focusableStartRef.value;\n            if (focusableStartEl === null)\n                return null;\n            let mainEl = focusableStartEl;\n            while (true) {\n                mainEl = mainEl.nextSibling;\n                if (mainEl === null)\n                    break;\n                if (mainEl instanceof Element && mainEl.tagName === 'DIV') {\n                    break;\n                }\n            }\n            return mainEl;\n        }\n        function activate() {\n            var _a;\n            if (props.disabled)\n                return;\n            stack.push(id);\n            if (props.autoFocus) {\n                const { initialFocusTo } = props;\n                if (initialFocusTo === undefined) {\n                    resetFocusTo('first');\n                }\n                else {\n                    (_a = resolveTo(initialFocusTo)) === null || _a === void 0 ? void 0 : _a.focus({ preventScroll: true });\n                }\n            }\n            activated = true;\n            document.addEventListener('focus', handleDocumentFocus, true);\n        }\n        function deactivate() {\n            var _a;\n            if (props.disabled)\n                return;\n            document.removeEventListener('focus', handleDocumentFocus, true);\n            stack = stack.filter((idInStack) => idInStack !== id);\n            if (isCurrentActive())\n                return;\n            const { finalFocusTo } = props;\n            if (finalFocusTo !== undefined) {\n                (_a = resolveTo(finalFocusTo)) === null || _a === void 0 ? void 0 : _a.focus({ preventScroll: true });\n            }\n            else if (props.returnFocusOnDeactivated) {\n                if (lastFocusedElement instanceof HTMLElement) {\n                    ignoreInternalFocusChange = true;\n                    lastFocusedElement.focus({ preventScroll: true });\n                    ignoreInternalFocusChange = false;\n                }\n            }\n        }\n        function resetFocusTo(target) {\n            if (!isCurrentActive())\n                return;\n            if (props.active) {\n                const focusableStartEl = focusableStartRef.value;\n                const focusableEndEl = focusableEndRef.value;\n                if (focusableStartEl !== null && focusableEndEl !== null) {\n                    const mainEl = getMainEl();\n                    if (mainEl == null || mainEl === focusableEndEl) {\n                        ignoreInternalFocusChange = true;\n                        focusableStartEl.focus({ preventScroll: true });\n                        ignoreInternalFocusChange = false;\n                        return;\n                    }\n                    ignoreInternalFocusChange = true;\n                    const focused = target === 'first'\n                        ? focusFirstDescendant(mainEl)\n                        : focusLastDescendant(mainEl);\n                    ignoreInternalFocusChange = false;\n                    if (!focused) {\n                        ignoreInternalFocusChange = true;\n                        focusableStartEl.focus({ preventScroll: true });\n                        ignoreInternalFocusChange = false;\n                    }\n                }\n            }\n        }\n        function handleStartFocus(e) {\n            if (ignoreInternalFocusChange)\n                return;\n            const mainEl = getMainEl();\n            if (mainEl === null)\n                return;\n            if (e.relatedTarget !== null && mainEl.contains(e.relatedTarget)) {\n                // if it comes from inner, focus last\n                resetFocusTo('last');\n            }\n            else {\n                // otherwise focus first\n                resetFocusTo('first');\n            }\n        }\n        function handleEndFocus(e) {\n            if (ignoreInternalFocusChange)\n                return;\n            if (e.relatedTarget !== null &&\n                e.relatedTarget === focusableStartRef.value) {\n                // if it comes from first, focus last\n                resetFocusTo('last');\n            }\n            else {\n                // otherwise focus first\n                resetFocusTo('first');\n            }\n        }\n        return {\n            focusableStartRef,\n            focusableEndRef,\n            focusableStyle: 'position: absolute; height: 0; width: 0;',\n            handleStartFocus,\n            handleEndFocus\n        };\n    },\n    render() {\n        const { default: defaultSlot } = this.$slots;\n        if (defaultSlot === undefined)\n            return null;\n        if (this.disabled)\n            return defaultSlot();\n        const { active, focusableStyle } = this;\n        return h(Fragment, null, [\n            h('div', {\n                'aria-hidden': 'true',\n                tabindex: active ? '0' : '-1',\n                ref: 'focusableStartRef',\n                style: focusableStyle,\n                onFocus: this.handleStartFocus\n            }),\n            defaultSlot(),\n            h('div', {\n                'aria-hidden': 'true',\n                style: focusableStyle,\n                ref: 'focusableEndRef',\n                tabindex: active ? '0' : '-1',\n                onFocus: this.handleEndFocus\n            })\n        ]);\n    }\n});\n"],"names":["resolveTo","selector","isHTMLElement","node","focusFirstDescendant","i","child","attemptFocus","focusLastDescendant","element","isFocusable","stack","FocusTrap","defineComponent","props","id","createId","focusableStartRef","ref","focusableEndRef","activated","ignoreInternalFocusChange","lastFocusedElement","isCurrentActive","handleDocumentKeydown","e","_a","onMounted","watch","value","activate","on","off","deactivate","onBeforeUnmount","handleDocumentFocus","mainEl","getMainEl","getPreciseEventTarget","resetFocusTo","focusableStartEl","initialFocusTo","idInStack","finalFocusTo","target","focusableEndEl","focused","handleStartFocus","handleEndFocus","defaultSlot","active","focusableStyle","Fragment"],"mappings":"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","x_google_ignoreList":[0,1,2]}